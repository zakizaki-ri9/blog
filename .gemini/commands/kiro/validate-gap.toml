description = "要件と既存のコードベース間の実装ギャップを分析する"
prompt = """
<meta>
description: 要件と既存のコードベース間の実装ギャップを分析する
argument-hint: <feature-name:$1>
arguments: {{args}}
</meta>

# 実装ギャップ検証 (Implementation Gap Validation)

<background_information>
- **ミッション**: 実装戦略に情報を提供するために、要件と既存のコードベース間のギャップを分析する
- **成功基準**:
  - 既存のコードベースパターンとコンポーネントの包括的な理解
  - 欠落している能力と統合の課題の明確な特定
  - 複数の実行可能な実装アプローチの評価
  - 設計フェーズのために特定された技術調査の必要性
</background_information>

<instructions>
## コアタスク
承認された要件と既存のコードベースに基づいて、機能 **$1** の実装ギャップを分析する。

## 実行ステップ

1. **コンテキストのロード**:
   - 言語とメタデータのために `.kiro/specs/$1/spec.json` を読み込む
   - 要件のために `.kiro/specs/$1/requirements.md` を読み込む
   - **すべてのステアリングコンテキストをロード**: `.kiro/steering/` ディレクトリ全体を読み込む:
     - デフォルトファイル: `structure.md`, `tech.md`, `product.md`
     - すべてのカスタムステアリングファイル（モード設定に関わらず）
     - これにより完全なプロジェクトメモリとコンテキストが提供される

2. **分析ガイドラインの読み込み**:
   - 包括的な分析フレームワークのために `.kiro/settings/rules/gap-analysis.md` を読み込む

3. **ギャップ分析の実行**:
   - 徹底的な調査のために gap-analysis.md フレームワークに従う
   - Grep および Read ツールを使用して既存のコードベースを分析する
   - 必要に応じて外部依存関係の調査に WebSearch/WebFetch を使用する
   - 複数の実装アプローチ（拡張/新規/ハイブリッド）を評価する
   - 出力には spec.json で指定された言語を使用する

4. **分析ドキュメントの生成**:
   - gap-analysis.md の出力ガイドラインに従って包括的なギャップ分析を作成する
   - トレードオフを伴う複数の実行可能なオプションを提示する
   - さらなる調査が必要な領域にフラグを立てる

## 重要な制約
- **決定より情報**: 最終的な実装の選択ではなく、分析とオプションを提供する
- **複数のオプション**: 該当する場合、実行可能な代替案を提示する
- **徹底的な調査**: 既存のコードベースを深く理解するためにツールを使用する
- **明示的なギャップ**: 調査や検討が必要な領域を明確にフラグ立てする
</instructions>

## ツールガイダンス
- **Read first**: 分析前にすべてのコンテキスト（仕様、ステアリング、ルール）をロードする
- **Grep extensively**: パターン、規約、統合ポイントについてコードベースを検索する
- **WebSearch/WebFetch**: 必要な場合、外部依存関係とベストプラクティスを調査する
- **Write last**: 完全な調査の後にのみ分析を生成する

## 出力記述
spec.json で指定された言語で以下を提供する:

1. **分析要約**: スコープ、課題、推奨事項の短い概要（3〜5箇条書き）
2. **ドキュメントステータス**: 使用された分析アプローチを確認
3. **次のステップ**: 設計フェーズに進むようユーザーを案内する

**フォーマット要件**:
- 明確さのためにMarkdown見出しを使用する
- 要約を簡潔に保つ（300語以内）
- 詳細な分析は gap-analysis.md の出力ガイドラインに従う

## 安全性とフォールバック

### エラーシナリオ
- **要件欠落**: requirements.md が存在しない場合、「最初に要件を生成するために `/kiro:spec-requirements $1` を実行してください」というメッセージと共に停止する
- **要件未承認**: 要件が承認されていない場合、ユーザーに警告するが進める（ギャップ分析は要件修正に役立つ可能性がある）
- **ステアリングディレクトリ空**: プロジェクトコンテキストが欠落しており分析品質に影響する可能性があることをユーザーに警告する
- **複雑な統合が不明確**: ブロックするのではなく、設計フェーズでの包括的な調査のためにフラグを立てる
- **言語未定義**: spec.json で言語が指定されていない場合、英語 (`en`) をデフォルトとする

### 次のフェーズ: 設計生成

**ギャップ分析完了の場合**:
- ギャップ分析の洞察をレビューする
- 技術設計ドキュメントを作成するために `/kiro:spec-design $1` を実行する
- または、要件を自動承認して直接進むために `/kiro:spec-design $1 -y` を実行する

**ノート**: ギャップ分析は任意だが、設計決定に情報を提供するためにブラウンフィールドプロジェクトには推奨される。

arguments: {{args}}
"""