description = "TDD手法を使用して仕様タスクを実行する"
prompt = """
<meta>
description: TDD手法を使用して仕様タスクを実行する
argument-hint: <feature-name:$1> [task-numbers:$2]
arguments: {{args}}
</meta>

# 実装タスク実行 (Implementation Task Executor)

<background_information>
- **ミッション**: 承認された仕様に基づいて、テスト駆動開発（TDD）手法を使用して実装タスクを実行する
- **成功基準**:
  - 実装コードの前にすべてのテストが記述されている
  - コードがすべてのテストに合格し、リグレッションがない
  - tasks.md でタスクが完了としてマークされている
  - 実装が設計および要件と整合している
</background_information>

<instructions>
## コアタスク
テスト駆動開発を使用して、機能 **$1** の実装タスクを実行する。

## 実行ステップ

### ステップ 1: コンテキストのロード

**必要なすべてのコンテキストを読み込む**:
- `.kiro/specs/$1/spec.json`, `requirements.md`, `design.md`, `tasks.md`
- **`.kiro/steering/` ディレクトリ全体**（完全なプロジェクトメモリのため）

**承認の検証**:
- spec.json でタスクが承認されていることを確認する（未承認の場合は停止、安全性とフォールバックを参照）

### ステップ 2: タスクの選択

**実行するタスクを決定する**:
- `$2` が提供された場合: 指定されたタスク番号を実行する（例：「1.1」または「1,2,3」）
- それ以外の場合: すべての保留中のタスク（tasks.md 内のチェックなし `- [ ]`）を実行する

### ステップ 3: TDDによる実行

選択された各タスクについて、Kent BeckのTDDサイクルに従う:

1. **RED - 失敗するテストを書く**:
   - 次の小さな機能のためのテストを書く
   - テストは失敗しなければならない（コードがまだ存在しないため）
   - 説明的なテスト名を使用する

2. **GREEN - 最小限のコードを書く**:
   - テストをパスさせるための最も単純な解決策を実装する
   - このテストをパスさせることのみに集中する
   - 過剰なエンジニアリングを避ける

3. **REFACTOR - クリーンアップ**:
   - コードの構造と可読性を改善する
   - 重複を排除する
   - 適切な場所にデザインパターンを適用する
   - リファクタリング後もすべてのテストがパスすることを確認する

4. **VERIFY - 品質の検証**:
   - すべてのテスト（新規および既存）がパスする
   - 既存の機能にリグレッションがない
   - コードカバレッジが維持または向上している

5. **MARK COMPLETE**:
   - tasks.md 内のチェックボックスを `- [ ]` から `- [x]` に更新する

## 重要な制約
- **TDD必須**: テストは実装コードの **前に** 書かれなければならない
- **タスクスコープ**: 特定のタスクが必要とするものだけを実装する
- **テストカバレッジ**: すべての新しいコードにはテストが必要である
- **リグレッションなし**: 既存のテストはパスし続けなければならない
- **設計整合性**: 実装は design.md の仕様に従わなければならない
</instructions>

## ツールガイダンス
- **Read first**: 実装前にすべてのコンテキストをロードする
- **Test first**: コードの前にテストを書く
- 必要に応じてライブラリドキュメントのために **WebSearch/WebFetch** を使用する

## 出力記述

spec.json で指定された言語で短い要約を提供する:

1. **実行されたタスク**: タスク番号とテスト結果
2. **ステータス**: tasks.md でマークされた完了タスク、残りのタスク数

**フォーマット**: 簡潔（150語以内）

## 安全性とフォールバック

### エラーシナリオ

**タスク未承認または仕様ファイル欠落**:
- **実行停止**: すべての仕様ファイルが存在し、タスクが承認されている必要がある
- **提案アクション**: "前のフェーズを完了してください: `/kiro:spec-requirements`, `/kiro:spec-design`, `/kiro:spec-tasks`"

**テスト失敗**:
- **実装停止**: 続行する前に失敗しているテストを修正する
- **アクション**: デバッグして修正し、その後再実行する

### タスク実行

**特定のタスクを実行**:
- `/kiro:spec-impl $1 1.1` - 単一タスク
- `/kiro:spec-impl $1 1,2,3` - 複数タスク

**すべての保留中を実行**:
- `/kiro:spec-impl $1` - すべてのチェックなしタスク

arguments: {{args}}
"""
