description = ".kiro/steering/ を永続的なプロジェクト知識として管理する"
prompt = """
<meta>
description: .kiro/steering/ を永続的なプロジェクト知識として管理する
</meta>

# Kiro ステアリング管理 (Steering Management)

<background_information>
- **役割**: `.kiro/steering/` を永続的なプロジェクトメモリとして維持する。
- **ミッション**:
  - ブートストラップ: コードベースからコアステアリングを生成する（初回）
  - 同期: ステアリングとコードベースを整合させる（メンテナンス）
  - 保存: ユーザーのカスタマイズは聖域であり、更新は追加的である
- **成功基準**:
  - ステアリングが網羅的なリストではなくパターンと原則をキャプチャしている
  - コードのドリフト（乖離）が検出され報告される
  - すべての `.kiro/steering/*.md` が平等に扱われる（コア + カスタム）
</background_information>

<instructions>
## シナリオ検出

`.kiro/steering/` ステータスを確認する:

**ブートストラップモード**: 空 または コアファイル（product.md, tech.md, structure.md）が欠落している
**同期モード**: すべてのコアファイルが存在する

---

## ブートストラップフロー

1. `.kiro/settings/templates/steering/` からテンプレートをロードする
2. コードベースを分析する (JIT):
   - ソースファイルのために `glob_file_search`
   - README, package.json 等のために `read_file`
   - パターンのために `grep`
3. パターンを抽出する（リストではない）:
   - Product: 目的、価値、コア能力
   - Tech: フレームワーク、決定事項、規約
   - Structure: 組織、命名、インポート
4. ステアリングファイルを生成する（テンプレートに従う）
5. `.kiro/settings/rules/steering-principles.md` から原則をロードする
6. レビューのために要約を提示する

**焦点**: ファイル/依存関係のカタログではなく、決定を導くパターン。

---

## 同期フロー

1. すべての既存ステアリング (`.kiro/steering/*.md`) をロードする
2. 変更についてコードベースを分析する (JIT)
3. ドリフトを検出する:
   - **Steering → Code**: 欠落している要素 → 警告
   - **Code → Steering**: 新しいパターン → 更新候補
   - **カスタムファイル**: 関連性をチェック
4. 更新を提案する（追加的、ユーザーコンテンツを保存）
5. レポート: 更新、警告、推奨事項

**更新哲学**: 追加し、置換しない。ユーザーセクションを保存する。

---

## 粒度の原則

`.kiro/settings/rules/steering-principles.md` より:

> 「新しいコードが既存のパターンに従っているなら、ステアリングを更新する必要はない。」

網羅的なリストではなく、パターンと原則を文書化する。

**悪い例**: ディレクトリツリー内のすべてのファイルをリストする
**良い例**: 例を用いて組織パターンを記述する

</instructions>

## ツールガイダンス

- `glob_file_search`: ソース/設定ファイルを見つける
- `read_file`: ステアリング、ドキュメント、設定を読む
- `grep`: パターンを検索する
- `list_dir`: 構造を分析する

**JIT戦略**: 事前ではなく、必要な時にフェッチする。

## 出力記述

チャット要約のみ（ファイルは直接更新される）。

### ブートストラップ:
```
✅ ステアリングを作成しました

## 生成:
- product.md: [短い説明]
- tech.md: [主要スタック]
- structure.md: [組織]

レビューし、信頼できる情報源 (Source of Truth) として承認してください。
```

### 同期:
```
✅ ステアリングを更新しました

## 変更:
- tech.md: React 18 → 19
- structure.md: APIパターンを追加

## コードドリフト:
- インポート規約に従っていないコンポーネント

## 推奨事項:
- api-standards.md を検討してください
```

## 例

### ブートストラップ
**入力**: 空のステアリング、React TypeScriptプロジェクト
**出力**: パターンを含む3ファイル - "機能ファースト", "TypeScript strict", "React 19"

### 同期
**入力**: 既存ステアリング、新しい `/api` ディレクトリ
**出力**: 更新された structure.md、非準拠ファイルのフラグ立て、提案された api-standards.md

## 安全性とフォールバック

- **セキュリティ**: キー、パスワード、シークレットを決して含めない（原則を参照）
- **不確実性**: 両方の状態を報告し、ユーザーに尋ねる
- **保存**: 疑わしい場合は置換ではなく追加する

## ノート

- すべての `.kiro/steering/*.md` はプロジェクトメモリとしてロードされる
- テンプレートと原則はカスタマイズのために外部化されている
- カタログではなくパターンに焦点を当てる
- 「黄金律」: パターンに従う新しいコードはステアリング更新を必要とすべきではない
- エージェント固有のツールディレクトリ（例：`.cursor/`, `.gemini/`, `.claude/`）の文書化は避ける
- `.kiro/settings/` コンテンツはステアリングファイルに文書化すべきではない（設定はメタデータであり、プロジェクト知識ではない）
- `.kiro/specs/` と `.kiro/steering/` への軽い言及は許容されるが、他の `.kiro/` ディレクトリは避ける

arguments: {{args}}
"""
