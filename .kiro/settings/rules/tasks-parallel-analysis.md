# 並行タスク分析ルール

## 目的
`tasks.md` を生成する際に、並行して安全に実行できる実装タスクを一貫した方法で特定する。

## タスクを並行可能と見なすタイミング
以下の **すべて** が真である場合にのみ、タスクを並行可能としてマークする:

1. 保留中のタスクに対する **データ依存がない**。
2. **競合するファイルや共有の可変リソース** に触れない。
3. 別のタスクからの **事前のレビュー/承認** が必要ない。
4. このタスクに必要な **環境/セットアップ作業** がすでに満たされているか、タスク内でカバーされている。

## マーキング規則
- 資格のある各タスクの数値識別子の直後に `(P)` を追加する。
  - 例: `- [ ] 2.1 (P) メールのバックグラウンドワーカーを構築する`
- 適切な場合、主要タスクとサブタスクの両方に `(P)` を適用する。
- シーケンシャル実行が要求された場合（例：`--sequential` フラグ経由）、`(P)` マーカーを完全に省略する。
- 完了状態との混同を避けるため、`(P)` はチェックボックスの括弧の **外側** に保つ。

## グループ化と順序付けのガイドライン
- 作業が同じテーマに属する場合は、並行タスクを同じ親の下にグループ化する。
- 明らかな前提条件や注意点を詳細箇条書きにリストする（例：「1.2からのスキーマ移行が必要」）。
- 2つのタスクが似ていても並行安全でない場合は、ブロッキング依存関係を明示的に呼び出す。
- コンテナのみの主要タスク（独自のアクション可能な詳細箇条書きを持たないもの）に `(P)` をマークすることはスキップし、代わりにサブタスクレベルで並行実行を評価する。

## 品質チェックリスト
タスクに `(P)` をマークする前に、以下を確認すること:

- このタスクを同時に実行しても、マージやデプロイの競合が発生しないことを検証した。
- 共有状態への期待を詳細箇条書きでキャプチャした。
- 実装が独立してテスト可能であることを確認した。

チェックに失敗した場合は、タスクに `(P)` を **マークせず**、タスクの詳細で依存関係を説明する。