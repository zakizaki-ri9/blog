# デプロイメント標準

[目的: 明確な環境とパイプラインパターンによる安全で再現可能なリリース]

## 哲学
- 自動化; デプロイ前にテスト; デプロイ後に検証
- 高速なロールバックを伴う段階的ロールアウトを優先する
- 本番環境の変更は可観測で可逆的でなければならない

## 環境
- Dev: 高速な反復; デバッグ有効
- Staging: 本番のミラー; リリース検証
- Prod: 強化済み; 監視済み; 最小特権

## CI/CD フロー
```
コード → テスト → ビルド → スキャン → デプロイ (ステージング) → 検証
```
原則:
- テスト/スキャンでフェイルファスト; デプロイをブロック
- アーティファクトビルドは再現可能（ロックファイル、固定バージョン）
- 本番への手動承認; 監査可能な証跡

## デプロイメント戦略
- ローリング: 段階的なインスタンス置換
- ブルーグリーン: 2つのプール間でトラフィックを切り替える
- カナリア: 少数のユーザーから開始し、健全性に基づいて拡大
リスクプロファイルごとに選択; デフォルトを文書化する。

## ゼロダウンタイム & マイグレーション
- ヘルスチェックでトラフィックをゲート制御; グレースフルシャットダウン
- ロールアウト中は後方互換性のあるDB変更
- 分離されたマイグレーションステップ; ロールバックパスのテスト

## ロールバック
- 前のバージョンを準備しておく; リバートを自動化する
- 修正して進むよりロールバックを速くする; トリガーを文書化する

## 設定 & シークレット
- 環境変数による12-factor設定; シークレットを決してコミットしない
- シークレットマネージャー; ローテーション; 最小特権; アクセス監査
- 起動時に必須環境変数を検証する

## ヘルス & モニタリング
- エンドポイント: `/health`, `/health/live`, `/health/ready`
- レイテンシ、エラー率、スループット、飽和度を監視
- SLO違反/スパイクでのアラート; 疲労を避けるために調整

## インシデント対応 & DR
- 標準プレイブック: 検出 → 評価 → 緩和 → コミュニケーション → 解決 → ポストモーテム
- 保持期間付きバックアップ; リストアテスト; 定義されたRPO/RTO

---
_ロールアウトパターンと安全策に焦点を当てる。プロバイダー固有のステップなし。_