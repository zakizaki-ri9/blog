# 技術設計書

---
**目的**: 実装者間での一貫性を確保し、解釈のずれを防ぐために十分な詳細を提供する。
---

## 概要 (Overview)
**目的**: この機能は、ブログ執筆者および閲覧者に、高速で安定したリンクカード表示を提供する。
**ユーザー**: 執筆者は外部サイトの変更を気にせずリンクを貼ることができ、閲覧者は軽量なリンクカードを通じて情報を得る。
**影響**: `LinkCard` コンポーネントから外部リクエストと画像表示を削除し、テキストベースのシンプルなUIに変更する。

### 目標 (Goals)
- `LinkCard` コンポーネントの外部リクエスト依存を排除する。
- ビルド時間の短縮と安定化。
- 既存の記事（URLのみ指定）でもエラーなく表示される後方互換性の維持。

### 非目標 (Non-Goals)
- 既存の記事すべてに対して手動でタイトルを付与すること（これはコンテンツ作業であり、本機能開発のスコープ外）。
- クライアントサイドでのOGP取得。

## アーキテクチャ (Architecture)

### 既存アーキテクチャ分析
現在は `LinkCard.astro` がビルド時に `src/utils/ogp.ts` を呼び出し、外部サイトへスクレイピングを行っている。これを廃止し、純粋な静的コンポーネントに変更する。

### アーキテクチャパターン & 境界マップ
**変更点**:
- `src/utils/ogp.ts` への依存を削除。
- 外部HTTPリクエストの削除。

### 技術スタック
| レイヤー | 選択 / バージョン | 機能における役割 | ノート |
|----------|-------------------|------------------|--------|
| フロントエンド | Astro Component | UI表示 | 既存の `.astro` ファイルを修正 |
| ユーティリティ | Standard URL API | ドメイン抽出 | 追加ライブラリなし |

## コンポーネントとインターフェース (Components and Interfaces)

### UI Components

#### LinkCard

| フィールド | 詳細 |
|------------|------|
| 意図 | 外部リンクをカード形式で表示する |
| 要件 | 1.1, 1.2, 2.1, 2.2, 2.3, 3.1, 3.2 |

**責任と制約**
- 与えられたURL、タイトル、説明文を表示する。
- 画像は表示しない。
- 外部リクエストを行わない。

**依存関係**
- なし（`src/utils/ogp.ts` への依存を削除）

**Props インターフェース**
```typescript
interface Props {
  url: string;
  title?: string;
  description?: string;
}
```

**実装詳細**
- `Astro.props` から `url`, `title`, `description` を受け取る。
- `domain` を `new URL(url).hostname` で取得する。
- 表示ロジック:
  - タイトル: `props.title` があれば表示。なければ `domain` または `url` を表示。
  - 説明文: `props.description` があれば表示。なければ非表示。
  - ドメイン: 常に表示（サイト名として）。
  - ファビコン: 表示しない（外部リクエストが必要なため）。
  - 画像: 表示しない。

**スタイリング変更**
- 画像表示用の `.image` クラスおよび関連スタイルを削除。
- テキスト領域 `.content` がカード全幅を使うように調整。

## 要件トレーサビリティ (Requirements Traceability)

| 要件ID | 要約 | コンポーネント | 実現方法 |
|--------|------|----------------|----------|
| 1.1 | メタデータ取得禁止 | LinkCard | `getOgpData` 呼び出しの削除 |
| 1.2 | 外部URL参照禁止 | LinkCard | `<img>` タグの削除、`favicon` 取得の廃止 |
| 2.1 | 画像非表示 | LinkCard | 画像表示用HTML/CSSの削除 |
| 2.2 | テキストレイアウト | LinkCard | タイトル、説明、ドメインのみの構成に変更 |
| 2.3 | レイアウト調整 | LinkCard | Flexboxレイアウトの簡素化 |
| 3.1 | ビルドエラー回避 | LinkCard | Propsのオプショナル化と内部でのNullチェック |
| 3.2 | 既存記事の表示 | LinkCard | URLのみの場合のフォールバック表示（ドメイン表示） |

## 移行戦略 (Migration Strategy)

1. `LinkCard.astro` を修正し、新しいProps定義とレンダリングロジックを適用。
2. `src/utils/ogp.ts` を削除。
3. `package.json` から不要になった依存ライブラリ（`cheerio` 等）を削除（※他の箇所で使われていないことを確認後）。

## テスト戦略 (Testing Strategy)

### 単体テスト (手動確認含む)
- `url` のみ渡した場合のレンダリング確認（ドメインが表示されるか）。
- `url`, `title`, `description` 全て渡した場合のレンダリング確認。
- 既存のブログ記事ページでの表示確認。

### ビルド検証
- `pnpm build` がエラーなく完了することを確認。
