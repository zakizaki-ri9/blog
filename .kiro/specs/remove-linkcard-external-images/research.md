# 調査 & 設計決定

## 要約
- **機能**: remove-linkcard-external-images
- **調査スコープ**: 拡張 (Extension)
- **主要な発見事項**:
  - `src/utils/ogp.ts` は `LinkCard.astro` からのみ使用されており、機能廃止後に安全に削除可能。
  - 既存の `LinkCard` コンポーネントのPropsを拡張することで、後方互換性を保ちつつ要件を満たせる。
  - URLパース処理は標準の `URL` オブジェクトで完結でき、外部ライブラリは不要。

## 調査ログ

### 既存コードベースの依存関係分析
- **コンテキスト**: `src/utils/ogp.ts` の影響範囲を確認し、削除の可否を判断する。
- **参照したソース**: `grep` によるコードベース検索。
- **発見事項**:
  - `utils/ogp` をインポートしているのは `src/components/LinkCard.astro` のみ。
- **含意**: `LinkCard` の改修が完了すれば、`ogp.ts` およびその依存ライブラリ（`cheerio` 等）は削除できる。

### コンポーネント拡張戦略
- **コンテキスト**: 既存の記事（URLのみ指定）と新規記事（タイトル手動指定）の両方に対応する必要がある。
- **発見事項**:
  - `Props` に `title`, `description` をオプショナルで追加する。
  - タイトルがない場合は、URLからドメインを抽出して表示するか、URLそのものを表示するフォールバックを設ける。
- **含意**: 既存のMDXファイルへの変更は不要。ビルドエラーも発生しない。

## 設計決定

### 決定: OGP取得ロジックの完全削除と手動入力への移行
- **コンテキスト**: ビルドパフォーマンス向上と外部依存排除のため。
- **検討された代替案**:
  1. ビルド時のみ取得し、キャッシュする（現状の維持・改善）
  2. クライアントサイドで取得する（CORS等の問題あり）
- **選択されたアプローチ**: 自動取得を廃止し、必要な情報はProps経由で手動入力する。既存記事についてはURL/ドメインのみの表示とする。
- **根拠**: 要件により「外部リクエストの禁止」が明示されているため。また、ブログのメンテナンス性を高めるため（リンク切れやOGP変更の影響を受けない）。
- **トレードオフ**: 既存記事のリンクカードの情報量が減る（画像、タイトルなし）。
- **フォローアップ**: 実装後、表示が寂しすぎる場合は、既存記事の主要なものだけ手動でタイトルを追記することを検討する。

## リスク & 緩和策
- **リスク**: 既存記事のリンクカードがURLのみになり、クリック率が下がる、または内容が伝わりにくくなる。
  - **緩和策**: ドメイン名を目立つように表示し、リンク先が何であるか（Qiita, Zenn, SpeakerDeck等）を認識しやすくする。

## 参照
- なし
