# ギャップ分析: LinkCardの外部リソース依存排除

## 分析要約
現在の `LinkCard` コンポーネントは、ビルド時に `src/utils/ogp.ts` を通じて外部URLへHTTPリクエストを行い、OGPメタデータ（タイトル、説明、画像など）を取得して表示しています。今回の要件では、この外部リクエストと画像表示を完全に廃止することが求められています。

主な課題は、**外部リクエストを廃止すると、URL以外の情報（タイトル、説明文）も自動取得できなくなる点**です。既存の記事（MDX）では `url` プロパティのみが渡されているため、そのままではタイトルが表示できなくなります。

推奨されるアプローチは、`LinkCard` コンポーネントを改修し、手動でタイトルや説明文を受け取れるように拡張しつつ、既存の使用箇所（URLのみ）に対してはURLまたはドメイン名のみを表示するフォールバックUIを提供することです。

## ドキュメントステータス
- **分析アプローチ**: 既存コード (`LinkCard.astro`, `ogp.ts`) と使用箇所 (`src/content/blog/*.mdx`) の静的解析
- **ステータス**: 完了

## 現状とギャップの詳細

### 1. 外部データ取得ロジック
- **現状**: `src/utils/ogp.ts` の `getOgpData` 関数が `fetch` と `cheerio` を使用してスクレイピングを行っている。
- **ギャップ**: 要件により、この処理は完全に削除される必要がある。
- **影響**: タイトル、説明文、サイト名、Favicon、OGP画像が自動取得できなくなる。

### 2. コンポーネントUI (`LinkCard.astro`)
- **現状**: 取得した `ogpData` オブジェクトに依存してレンダリングしている。画像 (`<img>`) を大きく表示するレイアウト。
- **ギャップ**:
  - 画像表示を削除する必要がある。
  - `ogpData` が存在しない前提での実装に変更する必要がある。
  - テキスト主体のレイアウト（タイトル、説明、ドメイン）への変更が必要。

### 3. データソースとProps
- **現状**: `Props` は `url: string` のみ。情報は内部で自動取得。
- **ギャップ**: 自動取得がなくなるため、タイトルや説明文を表示したい場合は、呼び出し元から渡す必要がある。
- **対応**: `Props` インターフェースを拡張し、`title`, `description` 等のオプショナルプロパティを追加する必要がある。

## 実装アプローチの選択肢

### オプションA: LinkCardの内部ロジック変更とProps拡張（推奨）
既存の `LinkCard.astro` を改修する。

1. **Props拡張**: `title?`, `description?` を追加。
2. **ロジック変更**: `getOgpData` の呼び出しを削除。
3. **表示ロジック**:
   - `title` が渡された場合 → それを表示。
   - `title` がない場合 → `url` またはドメイン名を表示（または「外部リンク」等の固定文言）。
   - `description` がある場合のみ表示。
   - 画像要素を削除。
   - サイト名/ドメイン名は `url` からパースして表示。

**トレードオフ**:
- ✅ 既存のMDXファイルを修正せずにビルドが通る（URLのみ表示されることになるが、エラーにはならない）。
- ✅ 新規記事では任意のタイトルを指定できる。
- ❌ 既存記事のリンクカードが「URLのみ」の寂しい表示になる（しかし、これは要件「外部取得廃止」の必然的な結果）。

### オプションB: 新規コンポーネント作成 (`SimpleLinkCard`)
`LinkCard` はそのまま（または非推奨化）にし、新しいコンポーネントを作成する。

**トレードオフ**:
- ❌ 既存の記事を一括置換する必要があり、工数が大きい。
- ❌ 要件3「既存コンテンツへの影響」の「エラーなくレンダリング」は満たすが、既存コンポーネントの中身を変える方が移行コストが低い。

### 結論
**オプションA** を採用します。既存の `LinkCard` を修正し、外部依存を取り除きます。

## 設計フェーズへの推奨事項

### 主要な決定
- `src/utils/ogp.ts` は不要になるため、本機能の実装完了後に削除または非推奨化を検討する（他の場所で使われていないか確認が必要）。
- `LinkCard` のPropsを拡張する: `interface Props { url: string; title?: string; description?: string; }`。
- URLのパース処理（ドメイン名抽出）は `LinkCard.astro` 内または軽量なユーティリティで行う（`ogp.ts` の重量級ライブラリ依存を避ける）。

### 調査項目
- 特になし。標準の `URL` クラスでドメイン抽出は可能。

## 実装の複雑さとリスク
- **工数**: S (1-2日) - コンポーネントの修正とスタイル調整のみ。
- **リスク**: Low - 外部依存が減るため、むしろ安定性は向上する。既存記事の表示情報量が減ることは仕様として許容する。

## 次のステップ
以下のコマンドを実行して技術設計書を作成してください。

```bash
/kiro:spec-design remove-linkcard-external-images
```
