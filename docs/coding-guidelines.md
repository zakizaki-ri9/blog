# コーディングガイドライン

このドキュメントは、Astro/TypeScript/セキュリティに特化したコーディングとコードレビューのガイドラインです。
実装時およびコードレビュー時に参照してください。

## Astro固有のチェック項目

### コンポーネントの適切な使用
- `.astro`ファイルでコンポーネントが適切にインポート・使用されているか
- クライアントサイドコンポーネント（`client:*`ディレクティブ）の使用が適切か
- サーバーコンポーネントとクライアントコンポーネントの境界が明確か

### 静的生成とSSRの適切な使い分け
- `output: "static"` と `output: "server"` の使い分けが適切か
- `getStaticPaths` の実装が正しいか（動的ルーティング時）
- 静的生成可能なページは静的生成されているか

### 画像最適化の確認
- `astro:assets` を使用した画像最適化が行われているか
- 画像のサイズとフォーマットが適切か
- 遅延読み込み（`loading="lazy"`）が適切に使用されているか

### SEO関連のメタタグ確認
- `<title>` タグが適切に設定されているか
- `<meta>` タグ（description, og:title, og:description等）が適切に設定されているか
- `BaseHead.astro` などの共通コンポーネントが適切に使用されているか

### パフォーマンス
- 不要なJavaScriptバンドルの読み込みがないか
- コンポーネントの分割が適切か（コード分割）
- 大きな依存関係のインポートが適切か

## TypeScriptチェック項目

### 型安全性の確保
- `any`型の使用が回避されているか（やむを得ない場合はコメントで理由を明記）
- 型アサーション（`as`）の使用が最小限か
- 型ガードが適切に使用されているか

### 厳密なnullチェック
- `strictNullChecks` が有効な環境でのnull/undefinedチェックが適切か
- オプショナルチェーン（`?.`）やnull合体演算子（`??`）が適切に使用されているか
- 非nullアサーション（`!`）の使用が適切か（最小限に）

### 型定義の適切性
- インターフェースと型エイリアスの使い分けが適切か
- ジェネリクスの使用が適切か
- ユニオン型とインターセクション型の使用が適切か

### インポート/エクスポート
- 型のみのインポートは `import type` を使用しているか
- エクスポートされる型が適切に定義されているか

## セキュリティチェック項目

### XSS対策
- Astroの自動エスケープが適切に機能しているか
- `set:html` や `set:text` の使用が適切か（信頼できないデータの場合は使用しない）
- ユーザー入力が適切にサニタイズされているか

### 環境変数の適切な管理
- 機密情報が環境変数として管理されているか
- `import.meta.env` の使用が適切か
- クライアントサイドで公開される環境変数に機密情報が含まれていないか（`PUBLIC_` プレフィックスの確認）

### 依存関係の脆弱性
- `pnpm audit` で検出された脆弱性が修正されているか
- 依存関係のバージョンが適切に管理されているか
- 不要な依存関係がインストールされていないか

### 機密情報のハードコーディング回避
- APIキー、パスワード、トークンなどがコードに直接記述されていないか
- 設定ファイルに機密情報が含まれていないか
- `.env` ファイルが適切に `.gitignore` に含まれているか

### 入力値検証の確認
- フォーム入力の検証が適切に行われているか
- URLパラメータの検証が適切に行われているか
- 外部APIからのレスポンスの検証が適切に行われているか

### 認証・認可
- 認証が必要なページが適切に保護されているか
- 認可チェックが適切に実装されているか
- セッション管理が適切に行われているか（SSR使用時）

### その他のセキュリティ考慮事項
- HTTPSの使用が強制されているか（本番環境）
- CORS設定が適切か
- セキュリティヘッダーが適切に設定されているか

## コード品質チェック項目

### 可読性
- 変数名・関数名が適切で意味が明確か
- コメントが適切に記述されているか（日本語で記述）
- 複雑なロジックが適切に分割されているか

### 保守性
- 重複コードがないか
- マジックナンバーが定数として定義されているか
- 設定値が適切に外部化されているか

### パフォーマンス
- 不要な再レンダリングがないか
- メモ化が適切に使用されているか（必要に応じて）
- 大きなデータの処理が適切に最適化されているか

### エラーハンドリング
- エラーが適切にハンドリングされているか
- エラーメッセージが適切に表示されているか
- ログが適切に記録されているか

## レビュー時の注意事項

- 重要度の高い問題（バグ、セキュリティ、パフォーマンス）を優先する
- 指摘は具体的で修正可能な内容にする
- 建設的なフィードバックを提供する
- コードの意図を理解してから指摘する

