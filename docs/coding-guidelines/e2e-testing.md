# E2Eテストガイドライン

このドキュメントでは、Playwrightを使用したE2Eテストの実装指針を定義します。

## 1. スモークテストの定義と目的

**スモークテスト (Smoke Test)** とは、「システムが燃えていないか（致命的な問題がないか）」を確認する最小限のテストです。

- **目的**: ビルドやデプロイが成功し、主要機能が動作可能な状態であることを迅速に確認する。
- **範囲**: トップページ表示、重要なナビゲーション、最低限のコンテンツ表示。
- **タイミング**: PR作成時（CI）、デプロイ直後。

## 2. テスト対象の選定基準

E2Eテストはメンテナンスコストが高くなりがちです。以下の基準で対象を選定してください。

| カテゴリ | テスト対象 | 理由 |
|---------|-----------|------|
| **スモークテスト** | トップページ、ログイン画面 | システム全体の健全性確認（必須） |
| **クリティカルパス** | 記事詳細、検索機能 | ユーザー体験の核心部分 |
| **レイアウト/スタイル** | 原則テストしない | 変更頻度が高く壊れやすいため（Visual Regression推奨） |

## 3. セレクター戦略（壊れにくいテストのために）

**アクセシビリティ対応のセレクター**を最優先で使用してください。

| 優先度 | セレクター | Playwrightメソッド | 例 |
|-------|-----------|-------------------|----|
| 🥇 | **Role** | `getByRole()` | `page.getByRole('button', { name: '送信' })` |
| 🥈 | **Text** | `getByText()` | `page.getByText('ようこそ')` |
| 🥉 | **Label** | `getByLabel()` | `page.getByLabel('メールアドレス')` |
| ⚠️ | **Test ID** | `getByTestId()` | `page.getByTestId('submit-btn')`（ユーザーに見えない属性のため乱用注意）|
| ❌ | **CSS/XPath** | `locator()` | `.btn-primary`, `//div[3]/span`（構造変更で壊れるため避ける） |

## 4. 回帰テストとの違い

| 項目 | スモークテスト | 回帰テスト |
|-----|--------------|-----------|
| **目的** | 「動くか？」 | 「壊れていないか？」 |
| **深さ** | 浅い（表示確認） | 深い（機能・データの正確性） |
| **実行頻度** | 高頻度（毎回） | リリース前など |

## 5. テストコードの品質

- **3行アサーション**: 1つのテストケースで確認することはシンプルに保つ。
- **明示的な待機を避ける**: `page.waitForTimeout()` は使用せず、Playwrightの自動待機（Auto-waiting）を活用する。
