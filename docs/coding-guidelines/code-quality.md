# コード品質ガイドライン

このドキュメントでは、コード品質チェック項目とレビュー時の注意事項を説明します。

## コード品質チェック項目

### 可読性

#### 変数名・関数名

- 変数名・関数名が適切で意味が明確か
- 略語の使用が適切か（過度な略語は避ける）
- 命名規則が一貫しているか

#### コメント

- コメントが適切に記述されているか（日本語で記述）
- 複雑なロジックに説明が添えられているか
- コメントがコードと同期しているか（古いコメントがないか）

#### コードの分割

- 複雑なロジックが適切に分割されているか
- 関数・クラスの責任が明確か
- 適切な抽象化レベルか

#### ベストプラクティス

```ts
// ❌ 悪い例: 意味が不明確
const d = new Date();
const x = process(d);

// ✅ 良い例: 意味が明確
const currentDate = new Date();
const processedDate = processDate(currentDate);
```

```ts
// ❌ 悪い例: 複雑なロジックが一つの関数に
function processData(data: Data[]) {
  // 100行以上の処理...
}

// ✅ 良い例: 適切に分割
function processData(data: Data[]) {
  const validated = validateData(data);
  const transformed = transformData(validated);
  return formatData(transformed);
}
```

### 保守性

#### 重複コード

- 重複コードがないか
- 共通化できる処理は関数・クラスに抽出されているか
- DRY原則（Don't Repeat Yourself）が守られているか

#### マジックナンバー

- マジックナンバーが定数として定義されているか
- 意味のある名前が付けられているか
- 設定値が適切に外部化されているか

#### 実装例

```ts
// ❌ 悪い例: マジックナンバー
if (user.age >= 18) {
  // ...
}

// ✅ 良い例: 定数として定義
const MINIMUM_AGE = 18;
if (user.age >= MINIMUM_AGE) {
  // ...
}
```

```ts
// ❌ 悪い例: 設定値のハードコーディング
const timeout = 5000;

// ✅ 良い例: 設定ファイルから取得
const timeout = config.apiTimeout;
```

### パフォーマンス

#### 不要な再レンダリング

- 不要な再レンダリングがないか
- メモ化が適切に使用されているか（必要に応じて）
- コンポーネントの分割が適切か

#### データ処理の最適化

- 大きなデータの処理が適切に最適化されているか
- 不要なループや計算がないか
- 適切なデータ構造が選択されているか

#### 実装例

```ts
// ❌ 悪い例: 毎回計算
function Component({ items }: { items: Item[] }) {
  const expensive = items.map(/* 重い処理 */);
  // ...
}

// ✅ 良い例: メモ化
import { useMemo } from 'react';

function Component({ items }: { items: Item[] }) {
  const expensive = useMemo(
    () => items.map(/* 重い処理 */),
    [items]
  );
  // ...
}
```

### エラーハンドリング

#### エラーの適切な処理

- エラーが適切にハンドリングされているか
- エラーメッセージが適切に表示されているか
- ログが適切に記録されているか

#### 実装例

```ts
// ❌ 悪い例: エラーを無視
try {
  await processData();
} catch (e) {
  // 何もしない
}

// ✅ 良い例: 適切なエラーハンドリング
try {
  await processData();
} catch (error) {
  console.error('Failed to process data:', error);
  // ユーザーに適切なメッセージを表示
  showErrorMessage('データの処理に失敗しました');
}
```

```ts
// ✅ 良い例: Result型の使用
type Result<T, E> = 
  | { success: true; data: T }
  | { success: false; error: E };

function processData(): Result<ProcessedData, Error> {
  try {
    const data = process();
    return { success: true, data };
  } catch (error) {
    return { success: false, error: error as Error };
  }
}
```

## レビュー時の注意事項

### 優先順位

重要度の高い問題（バグ、セキュリティ、パフォーマンス）を優先します。

- **高優先度**: バグ、セキュリティ問題、パフォーマンス問題
- **中優先度**: コード品質、保守性の問題
- **低優先度**: スタイル、命名の改善提案

### 指摘の仕方

#### 具体的で修正可能な内容にする

- 問題点を具体的に指摘
- 修正方法を提案（可能な場合）
- なぜ問題なのかを説明

#### 建設的なフィードバックを提供

- 批判的ではなく建設的な指摘
- 改善の余地がある点を指摘
- 良い点も認める

#### コードの意図を理解してから指摘

- コードの意図を理解してから指摘
- 文脈を考慮した指摘
- 質問形式で確認（必要に応じて）

### レビューチェックリスト

コードレビュー時に以下の項目を確認してください：

#### 機能性

- [ ] 要件を満たしているか
- [ ] エッジケースが考慮されているか
- [ ] エラーハンドリングが適切か

#### セキュリティ

- [ ] セキュリティ上の問題がないか
- [ ] 入力値検証が適切か
- [ ] 機密情報が適切に管理されているか

#### パフォーマンス

- [ ] パフォーマンス上の問題がないか
- [ ] 不要な処理がないか
- [ ] 適切に最適化されているか

#### コード品質

- [ ] 可読性が高いか
- [ ] 保守性が高いか
- [ ] テストが適切に書かれているか

#### 一貫性

- [ ] プロジェクトのコーディング規約に従っているか
- [ ] 既存のコードスタイルと一貫しているか
- [ ] 命名規則が統一されているか

## コード品質チェックリスト

実装時に以下の項目を確認してください：

- [ ] 変数名・関数名が適切で意味が明確か
- [ ] コメントが適切に記述されているか（日本語で記述）
- [ ] 複雑なロジックが適切に分割されているか
- [ ] 重複コードがないか
- [ ] マジックナンバーが定数として定義されているか
- [ ] 設定値が適切に外部化されているか
- [ ] 不要な再レンダリングがないか
- [ ] メモ化が適切に使用されているか（必要に応じて）
- [ ] 大きなデータの処理が適切に最適化されているか
- [ ] エラーが適切にハンドリングされているか
- [ ] エラーメッセージが適切に表示されているか
- [ ] ログが適切に記録されているか

## 関連ドキュメント

- [Astro/TypeScript](./astro-typescript.md) - Astro/TypeScript コーディングガイドライン
- [セキュリティ](./security.md) - セキュリティチェック項目
- [アーキテクチャ設計](./architecture.md) - テスト容易性を確保するアーキテクチャ
- [`AGENTS.md`](../../AGENTS.md) - エージェント開発ガイド
